<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kroger Location + Product Finder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="bg-glow bg-glow-a"></div>
  <div class="bg-glow bg-glow-b"></div>

  <main class="app-shell">
    <header class="hero">
      <p class="eyebrow">Weekly Meal Planner</p>
      <h1>Kroger Location + Product Explorer</h1>
      <p class="subhead">Find stores, select products into your app cart, compare totals by store, then sync cheapest cart to Kroger.</p>
    </header>

    <section class="panel panel-form">
      <h2>0. Weekly Meal Intake Form</h2>
      <form id="mealIntakeForm" class="controls meal-intake-controls" novalidate>
        <label>
          ZIP Code For Meal Pricing (optional for AI generation)
          <input id="mealPlanZip" name="mealPlanZip" type="text" maxlength="10" placeholder="85338" />
        </label>

        <label>
          How many people are meals for?
          <input id="peopleCount" name="peopleCount" type="number" min="1" max="12" value="1" required />
        </label>

        <label>
          How many meals per day?
          <input id="mealsPerDay" name="mealsPerDay" type="number" min="1" max="8" value="3" required />
        </label>

        <label>
          Existing Profile
          <select id="existingProfileSelect">
            <option value="">No saved profiles</option>
          </select>
        </label>

        <label>
          Optimization Goal
          <select id="optimizationGoal">
            <option value="BALANCED">Balanced</option>
            <option value="COST">Lowest Cost</option>
            <option value="VARIETY">Most Variety</option>
          </select>
        </label>

        <label>
          Max Prep Minutes / Meal
          <input id="maxPrepMinutes" name="maxPrepMinutes" type="number" min="1" max="180" value="20" required />
        </label>

        <label>
          Max Cook Minutes / Meal
          <input id="maxCookMinutes" name="maxCookMinutes" type="number" min="1" max="240" value="30" required />
        </label>

        <div class="action-row action-buttons compact-actions">
          <button id="createProfileBtn" type="button">Create New Unique Profile</button>
          <button id="loadIntakeProfileBtn" class="secondary-btn" type="button">Load Selected Profile</button>
        </div>
      </form>

      <p id="activeProfileId" class="status">Profile: not created</p>
      <div id="personRows" class="person-rows"></div>

      <div class="preference-grid">
        <label>
          Proteins for the week
          <textarea id="proteinsInput" rows="3" placeholder="chicken, salmon, eggs"></textarea>
        </label>

        <label>
          Veggies for the week
          <textarea id="veggiesInput" rows="3" placeholder="broccoli, spinach, bell peppers"></textarea>
        </label>

        <label>
          Carbs for the week
          <textarea id="carbsInput" rows="3" placeholder="rice, oats, potatoes"></textarea>
        </label>

        <label>
          Allergies / Exclusions
          <textarea id="allergiesInput" rows="3" placeholder="peanuts, shellfish"></textarea>
        </label>
      </div>

      <div class="action-row action-buttons">
        <button id="generateMealIntakeJsonBtn" type="submit" form="mealIntakeForm">Generate Weekly Plan</button>
      </div>

      <p id="mealIntakeStatus" class="status" aria-live="polite"></p>
    </section>

    <section class="panel panel-results">
      <div class="results-head">
        <h2>0a. Generated Weekly Plan</h2>
        <span id="mealPlanResultCount" class="count-pill">0 people</span>
      </div>
      <p id="mealPlanCheapestStoreStatus" class="status"></p>
      <div id="calorieTargetCards" class="cards"></div>
      <div id="mealPlanCards" class="groups"></div>
    </section>

    <section class="panel panel-results">
      <div class="results-head">
        <h2>0b. Consolidated Shopping List</h2>
        <span id="shoppingListCount" class="count-pill">0 ingredients</span>
      </div>
      <div id="shoppingListCards" class="cards"></div>
    </section>

    <section class="panel panel-form">
      <h2>1. Find Locations</h2>
      <form id="locationsForm" class="controls locations-controls" novalidate>
        <label>
          ZIP Code
          <input id="zip" name="zip" type="text" maxlength="10" placeholder="85338" required />
        </label>

        <label>
          Radius (miles)
          <input id="radius" name="radius" type="number" min="1" max="100" value="10" required />
        </label>

        <label>
          Limit
          <input id="limit" name="limit" type="number" min="1" max="50" value="5" required />
        </label>

        <button id="fetchLocationsBtn" type="submit">Fetch Locations</button>
      </form>

      <p id="locationStatus" class="status" aria-live="polite"></p>
    </section>

    <section class="panel panel-results">
      <div class="results-head">
        <h2>Location Results</h2>
        <span id="locationResultCount" class="count-pill">0 locations</span>
      </div>

      <div class="selection-bar">
        <span id="selectionCount" class="count-pill subtle">0 selected</span>
        <div class="selection-actions">
          <button id="selectAllBtn" class="secondary-btn" type="button">Select All</button>
          <button id="clearSelectionBtn" class="secondary-btn" type="button">Clear Selection</button>
        </div>
      </div>

      <div id="locationCards" class="cards"></div>
    </section>

    <section class="panel panel-form">
      <h2>2. Search Products Across Selected Locations</h2>
      <form id="productsForm" class="controls products-controls" novalidate>
        <label>
          Search Term
          <input id="term" name="term" type="text" maxlength="100" placeholder="milk" required />
        </label>

        <label>
          Brand (optional)
          <input id="brand" name="brand" type="text" maxlength="100" placeholder="Kroger" />
        </label>

        <label>
          Product Limit Per Location
          <input id="productLimit" name="productLimit" type="number" min="1" max="50" value="5" required />
        </label>

        <button id="searchProductsBtn" type="submit">Search Products</button>
      </form>

      <p id="productStatus" class="status" aria-live="polite"></p>
    </section>

    <section class="panel panel-results">
      <div class="results-head">
        <h2>3. Product Results (Select Items for Cart)</h2>
        <span id="productResultCount" class="count-pill">0 products</span>
      </div>

      <div id="productGroups" class="groups"></div>
    </section>

    <section class="panel panel-results">
      <div class="results-head">
        <h2>4. App Cart + Cheapest Store</h2>
        <span id="cartItemCount" class="count-pill">0 items</span>
      </div>

      <div class="action-row">
        <label>
          Cart Modality
          <select id="cartModality">
            <option value="PICKUP">PICKUP</option>
            <option value="DELIVERY">DELIVERY</option>
            <option value="SHIP">SHIP</option>
          </select>
        </label>
        <button id="clearCartBtn" class="secondary-btn" type="button">Clear App Cart</button>
      </div>

      <div id="appCartList" class="cart-list"></div>
      <div id="storeTotals" class="store-total-list"></div>
      <p id="cheapestStoreStatus" class="status"></p>
    </section>

    <section class="panel panel-results">
      <div class="results-head">
        <h2>5. Kroger Account + Cart Sync</h2>
      </div>

      <div class="action-row action-buttons">
        <button id="syncCheapestCartBtn" type="button">Sync Cheapest Cart to Kroger</button>
      </div>

      <p id="authStatus" class="status"></p>
      <p id="cartSyncStatus" class="status"></p>
    </section>

    <section class="panel panel-json">
      <h2>Raw JSON: Meal Planner Request</h2>
      <pre id="mealIntakeJson">{}</pre>
    </section>

    <section class="panel panel-json">
      <h2>Raw JSON: Locations</h2>
      <pre id="locationsRawJson">[]</pre>
    </section>

    <section class="panel panel-json">
      <h2>Raw JSON: Products</h2>
      <pre id="productsRawJson">[]</pre>
    </section>

    <section class="panel panel-json">
      <h2>Raw JSON: Meal Planner Response</h2>
      <pre id="profileRawJson">[]</pre>
    </section>

    <section class="panel panel-json">
      <h2>Raw JSON: Cart Sync</h2>
      <pre id="cartSyncRawJson">[]</pre>
    </section>
  </main>

  <script src="/app.js" defer></script>
</body>
</html>
